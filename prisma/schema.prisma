generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id              String            @id @default(cuid()) @map("_id")
  name            String
  email           String            @unique
  gitUsername     String            @unique
  twitterUsername String            @unique
  profileImage    String
  password        String?
  privateKey      String            @unique
  role            String            @default("USER")
  streak          Int?              @default(0)
  achievements    String[]          @default([])
  streakUpdatedAt DateTime          @default(now())
  pingTime        DateTime          @default(now())
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  googleId        String?           @unique
  totalPoints     Int?              @default(0)
  maxStreak       Int?              @default(0)
  website         String?
  activities      Activity[]
  dailyActivity   DailyActivity[]
  monthlyActivity MonthlyActivity[]

  @@index([privateKey])
}

model Activity {
  id                  String   @id @default(cuid()) @map("_id")
  userId              String
  languageName        String
  shortLanguageName   String   @default("NULL")
  totalDuration       Float?   @default(0)
  last24HoursDuration Float?   @default(0)
  last7DaysDuration   Float?   @default(0)
  lastUpdated         DateTime @default(now())
  createdAt           DateTime @default(now())
  last30DaysDuration  Float?   @default(0)
  User                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, languageName])
  @@index([userId])
}

model DailyActivity {
  id        String    @id @default(cuid()) @map("_id")
  userId    String
  weekDay   WeekDay
  date      DateTime
  duration  Float     @default(0)
  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt
  User      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId, weekDay])
  @@index([userId, date])
}

model MonthlyActivity {
  id            String    @id @default(cuid()) @map("_id")
  userId        String
  month         Month
  year          Int
  totalDuration Float     @default(0)
  createdAt     DateTime? @default(now())
  updatedAt     DateTime? @updatedAt
  User          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, month, year])
  @@index([userId, year, month])
}

enum WeekDay {
  SUNDAY
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
}

enum Month {
  JANUARY
  FEBRUARY
  MARCH
  APRIL
  MAY
  JUNE
  JULY
  AUGUST
  SEPTEMBER
  OCTOBER
  NOVEMBER
  DECEMBER
}
